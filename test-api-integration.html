<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIé›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .test-item {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
        }
        .test-item h3 {
            margin: 0 0 10px 0;
            color: #34495e;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª å‰ç«¯APIé›†æˆæµ‹è¯•</h1>
    <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•æç¤ºè¯ç®¡ç†å’Œå·¥å…·ç®¡ç†çš„APIé›†æˆåŠŸèƒ½</p>
    <p><strong>é¡µé¢è·¯å¾„ï¼š</strong></p>
    <ul>
        <li>æç¤ºè¯ç®¡ç†ï¼š<code>/prompt-management</code></li>
        <li>å·¥å…·ç®¡ç†ï¼š<code>/tool-management</code></li>
    </ul>
    <p><strong>APIè¯·æ±‚è·¯å¾„ï¼š</strong>æ‰€æœ‰APIè¯·æ±‚éƒ½ä½¿ç”¨ <code>/ai-api</code> å‰ç¼€</p>

    <!-- æç¤ºè¯ç®¡ç†APIæµ‹è¯• -->
    <div class="test-section">
        <h2>ğŸ“ æç¤ºè¯ç®¡ç†APIæµ‹è¯•</h2>
        
        <div class="test-item">
            <h3>è·å–æç¤ºè¯åˆ—è¡¨</h3>
            <button class="test-button" onclick="testPromptsList()">æµ‹è¯• GET /api/prompts/</button>
            <div id="prompts-list-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>è·å–åˆ†ç±»åˆ—è¡¨</h3>
            <button class="test-button" onclick="testPromptsCategories()">æµ‹è¯• GET /api/prompts/categories/list</button>
            <div id="prompts-categories-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>æœç´¢æç¤ºè¯</h3>
            <input type="text" id="search-keyword" placeholder="è¾“å…¥æœç´¢å…³é”®è¯" value="åˆ†æ">
            <button class="test-button" onclick="testPromptsSearch()">æµ‹è¯• GET /api/prompts/search/</button>
            <div id="prompts-search-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>åˆ›å»ºæç¤ºè¯</h3>
            <button class="test-button" onclick="testCreatePrompt()">æµ‹è¯• POST /api/prompts/</button>
            <div id="create-prompt-result" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- å·¥å…·ç®¡ç†APIæµ‹è¯• -->
    <div class="test-section">
        <h2>ğŸ”§ å·¥å…·ç®¡ç†APIæµ‹è¯•</h2>
        
        <div class="test-item">
            <h3>è·å–å·¥å…·åˆ—è¡¨</h3>
            <button class="test-button" onclick="testToolsList()">æµ‹è¯• GET /api/tools/list</button>
            <div id="tools-list-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>è·å–å·¥å…·åˆ†ç±»</h3>
            <button class="test-button" onclick="testToolsCategories()">æµ‹è¯• GET /api/tools/categories</button>
            <div id="tools-categories-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>è·å–å·¥å…·ç»Ÿè®¡</h3>
            <button class="test-button" onclick="testToolsStatistics()">æµ‹è¯• GET /api/tools/statistics</button>
            <div id="tools-statistics-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>æ‰«æå·¥å…·</h3>
            <button class="test-button" onclick="testToolsScan()">æµ‹è¯• POST /api/tools/scan</button>
            <div id="tools-scan-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>åŒæ­¥å…ƒæ•°æ®</h3>
            <button class="test-button" onclick="testToolsSync()">æµ‹è¯• POST /api/tools/sync</button>
            <div id="tools-sync-result" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // åŸºç¡€é…ç½®
        const API_BASE_URL = 'http://localhost:8000'; // æ ¹æ®å®é™…åç«¯åœ°å€è°ƒæ•´
        
        // é€šç”¨è¯·æ±‚å‡½æ•°
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(API_BASE_URL + url, {
                    headers: {
                        'Content-Type': 'application/json',
                        // å¦‚æœéœ€è¦è®¤è¯ï¼Œåœ¨è¿™é‡Œæ·»åŠ token
                        // 'Authorization': 'Bearer ' + localStorage.getItem('auth_token')
                    },
                    ...options
                });
                
                const data = await response.json();
                return {
                    success: response.ok,
                    status: response.status,
                    data: data
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showResult(elementId, result) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            
            if (result.success) {
                element.className = 'test-result success';
                element.textContent = `âœ… è¯·æ±‚æˆåŠŸ (${result.status})\n\n${JSON.stringify(result.data, null, 2)}`;
            } else {
                element.className = 'test-result error';
                element.textContent = `âŒ è¯·æ±‚å¤±è´¥\n\n${result.error || JSON.stringify(result.data, null, 2)}`;
            }
        }

        // æç¤ºè¯ç®¡ç†APIæµ‹è¯•å‡½æ•°
        async function testPromptsList() {
            const result = await makeRequest('/api/prompts/?page=1&page_size=5');
            showResult('prompts-list-result', result);
        }

        async function testPromptsCategories() {
            const result = await makeRequest('/api/prompts/categories/list');
            showResult('prompts-categories-result', result);
        }

        async function testPromptsSearch() {
            const keyword = document.getElementById('search-keyword').value;
            const result = await makeRequest(`/api/prompts/search/?keyword=${encodeURIComponent(keyword)}&limit=5`);
            showResult('prompts-search-result', result);
        }

        async function testCreatePrompt() {
            const testData = {
                name: "æµ‹è¯•æç¤ºè¯_" + Date.now(),
                content: "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æç¤ºè¯çš„å†…å®¹ï¼Œç”¨äºéªŒè¯APIåŠŸèƒ½ã€‚",
                description: "APIæµ‹è¯•åˆ›å»ºçš„æç¤ºè¯",
                category: "æµ‹è¯•åˆ†ç±»",
                tags: "æµ‹è¯•,API,è‡ªåŠ¨åŒ–"
            };
            
            const result = await makeRequest('/api/prompts/', {
                method: 'POST',
                body: JSON.stringify(testData)
            });
            showResult('create-prompt-result', result);
        }

        // å·¥å…·ç®¡ç†APIæµ‹è¯•å‡½æ•°
        async function testToolsList() {
            const result = await makeRequest('/api/tools/list?page=1&page_size=5');
            showResult('tools-list-result', result);
        }

        async function testToolsCategories() {
            const result = await makeRequest('/api/tools/categories');
            showResult('tools-categories-result', result);
        }

        async function testToolsStatistics() {
            const result = await makeRequest('/api/tools/statistics');
            showResult('tools-statistics-result', result);
        }

        async function testToolsScan() {
            const result = await makeRequest('/api/tools/scan', {
                method: 'POST',
                body: JSON.stringify({
                    auto_register: true
                })
            });
            showResult('tools-scan-result', result);
        }

        async function testToolsSync() {
            const result = await makeRequest('/api/tools/sync', {
                method: 'POST'
            });
            showResult('tools-sync-result', result);
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('APIé›†æˆæµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // æ˜¾ç¤ºå½“å‰é…ç½®
            const infoDiv = document.createElement('div');
            infoDiv.className = 'test-result info';
            infoDiv.innerHTML = `â„¹ï¸ å½“å‰APIåŸºç¡€åœ°å€: ${API_BASE_URL}\n\nå¦‚æœåç«¯åœ°å€ä¸åŒï¼Œè¯·ä¿®æ”¹è„šæœ¬ä¸­çš„ API_BASE_URL å˜é‡ã€‚`;
            document.body.insertBefore(infoDiv, document.body.firstChild.nextSibling);
        });
    </script>
</body>
</html>
